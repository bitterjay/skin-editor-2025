<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Skin Editor</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <!-- Embedded default configuration to avoid CORS when loading from file:// -->
  <script id="defaultConfig" type="application/json">
{
  "name": "",
  "identifier": "",
  "gameTypeIdentifier": "",
  "debug": false,
  "representations": {
    "iphone": {
      "edgeToEdge": {
        "portrait": {
          "assets": {},
          "items": [],
          "mappingSize": {
            "width": 0,
            "height": 0
          },
          "extendedEdges": {},
          "menuInsets": {}
        }
      }
    }
  }
}
  </script>

  <header>
    <button class="icon-button" id="menuToggle">
      <img src="icons/ellipsis_icon.svg" class="icon" alt="Menu" />
    </button>
    <div class="context-menu" id="contextMenu">
      <button><img src="icons/hamburger_icon.svg" class="icon" alt="Navigation" /></button>
      <button><img src="icons/gear_icon.svg" class="icon" alt="Settings" /></button>
      <button><img src="icons/code_icon.svg" class="icon" alt="Code" /></button>
      <button><img src="icons/ellipsis_icon.svg" class="icon" alt="Close Menu" /></button>
    </div>
    </header>

    <div class="overlay" id="codeOverlay">
      <div class="overlay-context-menu" id="codeMenu">
        <button id="codeClose"><img src="icons/close_icon.svg" class="icon" alt="Close" /></button>
      </div>
      <pre id="codeContent"></pre>
    </div>

    <div class="overlay" id="gearSettingsOverlay">
      <div class="overlay-context-menu" id="gearSettingsMenu">
        <button id="gearSettingsClose"><img src="icons/close_icon.svg" class="icon" alt="Close" /></button>
      </div>
      <div class="overlay-content">
        <h2>Device Settings</h2>
        <label for="phoneModel">Phone</label>
        <select id="phoneModel">
          <option value="">Select a phone model</option>
        </select>
      </div>
    </div>

    <div class="overlay" id="settingsOverlay">
      <div class="overlay-context-menu" id="settingsMenu">
        <button id="settingsSave">
          <img src="icons/save_icon.svg" class="icon" alt="Save" />
        </button>
        <button id="settingsClose"><img src="icons/close_icon.svg" class="icon" alt="Close" /></button>
        
      </div>
    <!-- skin settings -->
    <div class="overlay-content">
      <h2>Skin Settings</h2>
      <label for="skinName">Name</label>
      <input id="skinName" type="text" placeholder="Enter skin name" />
      <p class="help-text">This is what the skin will be called within Delta's skin selection menu.</p>
      
      <label for="skinIdentifier">Identifier</label>
      <input id="skinIdentifier" type="text" placeholder="com.yourname.console.skinname" />
      <p class="help-text">Follow Apple's reverse-dns format: com.yourname.console.skinname</p>
      
      <label for="gameTypeIdentifier">Console / System</label>
      <select id="gameTypeIdentifier">
        <!-- Options will be populated dynamically -->
      </select>
      <p class="help-text">Select which system the skin belongs to.</p>
      <div class="checkbox-container">
          <input type="checkbox" id="debugToggle" />
          <label for="debugToggle">Enable Debug Mode</label>
        </div>
    </div>
  </div>

<!-- Work area container -->
<div id="workArea">
  <!-- Screen representation with red border -->
  <div id="screenRepresentation" style="border: 2px solid red; display: flex; justify-content: center; align-items: center;">
    <div id="screenMessage" style="font-size: 24px; color: #666;">Select a phone size to get started</div>
  </div>
  <!-- Logical dimensions display -->
  <div id="logicalDimensions" style="margin-top: 10px; text-align: center; display: none;">
    <p><strong>Model: <span id="logicalModelDisplay"></span></strong></p>
    <p>Logical Width: <span id="logicalWidthDisplay"></span>px</p>
    <p>Logical Height: <span id="logicalHeightDisplay"></span>px</p>
  </div>
</div>

<!-- Floating Add Button -->
<div id="addButtonFloating" class="disabled">
  <img src="icons/plus_icon.svg" class="icon" alt="Add Button" />
</div>

<!-- Embedded iPhone sizes data as fallback -->
<script id="iphoneSizesData" type="application/json">
[
  {
    "model": "iPhone 16 Pro Max",
    "logicalWidth": 440,
    "logicalHeight": 956,
    "physicalWidth": 1320,
    "physicalHeight": 2868,
    "ppi": 460
  },
  {
    "model": "iPhone 16 Pro",
    "logicalWidth": 402,
    "logicalHeight": 874,
    "physicalWidth": 1206,
    "physicalHeight": 2622,
    "ppi": 460
  },
  {
    "model": "iPhone 16 Plus",
    "logicalWidth": 430,
    "logicalHeight": 932,
    "physicalWidth": 1290,
    "physicalHeight": 2796,
    "ppi": 460
  },
  {
    "model": "iPhone 16",
    "logicalWidth": 393,
    "logicalHeight": 852,
    "physicalWidth": 1179,
    "physicalHeight": 2556,
    "ppi": 460
  },
  {
    "model": "iPhone 15 Pro Max",
    "logicalWidth": 430,
    "logicalHeight": 932,
    "physicalWidth": 1290,
    "physicalHeight": 2796,
    "ppi": 460
  },
  {
    "model": "iPhone 15 Pro",
    "logicalWidth": 393,
    "logicalHeight": 852,
    "physicalWidth": 1179,
    "physicalHeight": 2556,
    "ppi": 460
  },
  {
    "model": "iPhone 15 Plus",
    "logicalWidth": 430,
    "logicalHeight": 932,
    "physicalWidth": 1290,
    "physicalHeight": 2796,
    "ppi": 460
  },
  {
    "model": "iPhone 15",
    "logicalWidth": 393,
    "logicalHeight": 852,
    "physicalWidth": 1179,
    "physicalHeight": 2556,
    "ppi": 460
  },
  {
    "model": "iPhone 14 Plus",
    "logicalWidth": 428,
    "logicalHeight": 926,
    "physicalWidth": 1284,
    "physicalHeight": 2778,
    "ppi": 458
  },
  {
    "model": "iPhone 14 Pro Max",
    "logicalWidth": 430,
    "logicalHeight": 932,
    "physicalWidth": 1290,
    "physicalHeight": 2796,
    "ppi": 460
  },
  {
    "model": "iPhone 14 Pro",
    "logicalWidth": 393,
    "logicalHeight": 852,
    "physicalWidth": 1179,
    "physicalHeight": 2556,
    "ppi": 460
  },
  {
    "model": "iPhone 14",
    "logicalWidth": 390,
    "logicalHeight": 844,
    "physicalWidth": 1170,
    "physicalHeight": 2532,
    "ppi": 460
  },
  {
    "model": "iPhone SE 3rd gen",
    "logicalWidth": 375,
    "logicalHeight": 667,
    "physicalWidth": 750,
    "physicalHeight": 1334,
    "ppi": 326
  },
  {
    "model": "iPhone 13 Pro Max",
    "logicalWidth": 428,
    "logicalHeight": 926,
    "physicalWidth": 1284,
    "physicalHeight": 2778,
    "ppi": 458
  },
  {
    "model": "iPhone 13 Pro",
    "logicalWidth": 390,
    "logicalHeight": 844,
    "physicalWidth": 1170,
    "physicalHeight": 2532,
    "ppi": 460
  },
  {
    "model": "iPhone 13 mini",
    "logicalWidth": 375,
    "logicalHeight": 812,
    "physicalWidth": 1080,
    "physicalHeight": 2340,
    "ppi": 476
  },
  {
    "model": "iPhone 13",
    "logicalWidth": 390,
    "logicalHeight": 844,
    "physicalWidth": 1170,
    "physicalHeight": 2532,
    "ppi": 460
  },
  {
    "model": "iPhone 12 Pro Max",
    "logicalWidth": 428,
    "logicalHeight": 926,
    "physicalWidth": 1284,
    "physicalHeight": 2778,
    "ppi": 458
  },
  {
    "model": "iPhone 12 Pro",
    "logicalWidth": 390,
    "logicalHeight": 844,
    "physicalWidth": 1170,
    "physicalHeight": 2532,
    "ppi": 460
  },
  {
    "model": "iPhone 12 mini",
    "logicalWidth": 375,
    "logicalHeight": 812,
    "physicalWidth": 1080,
    "physicalHeight": 2340,
    "ppi": 476
  },
  {
    "model": "iPhone 12",
    "logicalWidth": 390,
    "logicalHeight": 844,
    "physicalWidth": 1170,
    "physicalHeight": 2532,
    "ppi": 460
  },
  {
    "model": "iPhone SE 2nd gen",
    "logicalWidth": 375,
    "logicalHeight": 667,
    "physicalWidth": 750,
    "physicalHeight": 1334,
    "ppi": 326
  },
  {
    "model": "iPhone 11 Pro Max",
    "logicalWidth": 414,
    "logicalHeight": 896,
    "physicalWidth": 1242,
    "physicalHeight": 2688,
    "ppi": 458
  },
  {
    "model": "iPhone 11 Pro",
    "logicalWidth": 375,
    "logicalHeight": 812,
    "physicalWidth": 1125,
    "physicalHeight": 2436,
    "ppi": 458
  },
  {
    "model": "iPhone 11",
    "logicalWidth": 414,
    "logicalHeight": 896,
    "physicalWidth": 828,
    "physicalHeight": 1792,
    "ppi": 326
  },
  {
    "model": "iPhone XR",
    "logicalWidth": 414,
    "logicalHeight": 896,
    "physicalWidth": 828,
    "physicalHeight": 1792,
    "ppi": 326
  },
  {
    "model": "iPhone XS Max",
    "logicalWidth": 414,
    "logicalHeight": 896,
    "physicalWidth": 1242,
    "physicalHeight": 2688,
    "ppi": 458
  },
  {
    "model": "iPhone XS",
    "logicalWidth": 375,
    "logicalHeight": 812,
    "physicalWidth": 1125,
    "physicalHeight": 2436,
    "ppi": 458
  },
  {
    "model": "iPhone X",
    "logicalWidth": 375,
    "logicalHeight": 812,
    "physicalWidth": 1125,
    "physicalHeight": 2436,
    "ppi": 458
  }
]
  </script>

  <!-- Embedded game type identifiers data as fallback -->
  <script id="gameTypeIdentifiersData" type="application/json">
[
  {
    "console": "GameBoy (Color)",
    "gameTypeIdentifier": "com.rileytestut.delta.game.gbc"
  },
  {
    "console": "GameBoy Advance",
    "gameTypeIdentifier": "com.rileytestut.delta.game.gba"
  },
  {
    "console": "Nintendo DS",
    "gameTypeIdentifier": "com.rileytestut.delta.game.ds"
  },
  {
    "console": "Nintendo Entertainment System",
    "gameTypeIdentifier": "com.rileytestut.delta.game.nes"
  },
  {
    "console": "Super Nintendo Entertainment System",
    "gameTypeIdentifier": "com.rileytestut.delta.game.snes"
  },
  {
    "console": "Nintendo 64",
    "gameTypeIdentifier": "com.rileytestut.delta.game.n64"
  },
  {
    "console": "Sega Genesis (Beta)",
    "gameTypeIdentifier": "com.rileytestut.delta.game.genesis"
  }
]
  </script>

  <script>
    // Data for iPhone sizes and game type identifiers
    let iphoneSizes = [];
    let gameTypeIdentifiers = [];

    // Function to load JSON data
    async function loadJsonData() {
      try {
        // Try to load iPhone sizes data from file
        try {
          const iphoneSizesResponse = await fetch('Reference/iphone-sizes.json');
          iphoneSizes = await iphoneSizesResponse.json();
        } catch (error) {
          // Fallback to embedded data
          console.warn('Falling back to embedded iPhone sizes data');
          const iphoneSizesJson = document.getElementById('iphoneSizesData').textContent;
          iphoneSizes = JSON.parse(iphoneSizesJson);
        }
        
        // Try to load game type identifiers data from file
        try {
          const gameTypeIdentifiersResponse = await fetch('Reference/gameTypeIdentifiers.json');
          gameTypeIdentifiers = await gameTypeIdentifiersResponse.json();
        } catch (error) {
          // Fallback to embedded data
          console.warn('Falling back to embedded game type identifiers data');
          const gameTypeIdentifiersJson = document.getElementById('gameTypeIdentifiersData').textContent;
          gameTypeIdentifiers = JSON.parse(gameTypeIdentifiersJson);
        }
        
        // Initialize dropdowns after data is loaded
        populateGameTypeDropdown();
        populatePhoneModelDropdown();
      } catch (error) {
        console.error('Error loading JSON data:', error);
      }
    }

    let currentConfig;
    function loadConfig() {
      const saved = localStorage.getItem('currentConfig');
      if (saved) {
        currentConfig = JSON.parse(saved);
      } else {
        const defaultJson = document.getElementById('defaultConfig').textContent;
        currentConfig = JSON.parse(defaultJson);
        localStorage.setItem('currentConfig', JSON.stringify(currentConfig));
      }
    }
    loadConfig();

    // Function to populate the game type dropdown
    function populateGameTypeDropdown() {
      const dropdown = document.getElementById('gameTypeIdentifier');
      
      // Clear existing options
      dropdown.innerHTML = '<option value="">Select a console</option>';
      
      // Add options from the gameTypeIdentifiers array
      if (gameTypeIdentifiers.length > 0) {
        gameTypeIdentifiers.forEach(item => {
          const option = document.createElement('option');
          option.value = item.gameTypeIdentifier;
          option.textContent = item.console;
          dropdown.appendChild(option);
        });
      }
    }

    // Initialize code content
    const codeContent = document.getElementById('codeContent');
    codeContent.textContent = JSON.stringify(currentConfig, null, 2);
    
    // Load JSON data when the page loads
    loadJsonData();

    // Menu toggle
    const toggle = document.getElementById('menuToggle');
    const menu = document.getElementById('contextMenu');
    toggle.addEventListener('click', () => {
      menu.classList.toggle('open');
    });

    // Close menu button
    const closeBtn = document.querySelector('#contextMenu button img[alt="Close Menu"]');
    if (closeBtn) {
      closeBtn.parentElement.addEventListener('click', () => {
        menu.classList.remove('open');
      });
    }
    
    // Floating Add Button click handler
    const addButtonFloating = document.getElementById('addButtonFloating');
    addButtonFloating.addEventListener('click', function() {
      // Only allow click if not disabled
      if (!this.classList.contains('disabled')) {
        console.log('Add Button clicked - would add a button to the skin');
        // Add your button creation logic here
      }
    });

    // Code overlay
    const codeBtn = document.querySelector('#contextMenu button img[alt="Code"]').parentElement;
    codeBtn.addEventListener('click', () => {
      const overlay = document.getElementById('codeOverlay');
      codeContent.textContent = JSON.stringify(currentConfig, null, 2);
      overlay.style.display = 'flex';
      menu.classList.remove('open');
    });

    document.getElementById('codeClose').addEventListener('click', () => {
      document.getElementById('codeOverlay').style.display = 'none';
    });

    // Gear settings overlay
    const gearBtn = document.querySelector('#contextMenu button img[alt="Settings"]').parentElement;
    const gearSettingsOverlay = document.getElementById('gearSettingsOverlay');
    
    gearBtn.addEventListener('click', () => {
      document.getElementById('debugToggle').checked = currentConfig.debug;
      gearSettingsOverlay.style.display = 'flex';
      menu.classList.remove('open');
    });

    // Function to populate the phone model dropdown
    function populatePhoneModelDropdown() {
      const dropdown = document.getElementById('phoneModel');
      
      // Clear existing options
      dropdown.innerHTML = '<option value="">Select a phone model</option>';
      
      // Add options from the iphoneSizes array
      if (iphoneSizes.length > 0) {
        iphoneSizes.forEach(item => {
          const option = document.createElement('option');
          option.value = item.model;
          option.textContent = item.model;
          dropdown.appendChild(option);
        });
      }
    }
    
    // Handle phone model selection
    document.getElementById('phoneModel').addEventListener('change', function() {
      const selectedModel = this.value;
      const dimensionsDiv = document.getElementById('phoneDimensions');
      const logicalDimensionsDiv = document.getElementById('logicalDimensions');
      const screenRepresentation = document.getElementById('screenRepresentation');
      const addButtonFloating = document.getElementById('addButtonFloating');
      
      if (selectedModel) {
        // Find the selected phone model data
        const phoneData = iphoneSizes.find(item => item.model === selectedModel);
        
        if (phoneData) {
          // // Update the dimensions display in gear settings
          // document.getElementById('logicalWidth').textContent = phoneData.logicalWidth;
          // document.getElementById('logicalHeight').textContent = phoneData.logicalHeight;
          // dimensionsDiv.style.display = 'block';
          
          // Update the logical dimensions display below screen representation
          document.getElementById('logicalModelDisplay').textContent = selectedModel;
          document.getElementById('logicalWidthDisplay').textContent = phoneData.logicalWidth;
          document.getElementById('logicalHeightDisplay').textContent = phoneData.logicalHeight;
          logicalDimensionsDiv.style.display = 'block';
          
          // Update the screen representation dimensions
          screenRepresentation.style.width = phoneData.logicalWidth + 'px';
          screenRepresentation.style.height = phoneData.logicalHeight + 'px';
          
          // Hide the message when a phone is selected
          document.getElementById('screenMessage').style.display = 'none';
          
          // Enable the floating Add Button when a phone is selected
          addButtonFloating.classList.remove('disabled');
        } else {
          dimensionsDiv.style.display = 'none';
          logicalDimensionsDiv.style.display = 'none';
          // Reset screen representation to full size
          screenRepresentation.style.width = '100%';
          screenRepresentation.style.height = '100%';
          document.getElementById('screenMessage').style.display = 'block';
          
          // Disable the floating Add Button when no valid phone is selected
          addButtonFloating.classList.add('disabled');
        }
      } else {
        dimensionsDiv.style.display = 'none';
        logicalDimensionsDiv.style.display = 'none';
        // Reset screen representation to full size
        screenRepresentation.style.width = '100%';
        screenRepresentation.style.height = '100%';
        document.getElementById('screenMessage').style.display = 'block';
        
        // Disable the floating Add Button when no phone is selected
        addButtonFloating.classList.add('disabled');
      }
    });
    
    document.getElementById('gearSettingsClose').addEventListener('click', () => {
      gearSettingsOverlay.style.display = 'none';
    });
    
    document.getElementById('debugToggle').addEventListener('change', (e) => {
      currentConfig.debug = e.target.checked;
      localStorage.setItem('currentConfig', JSON.stringify(currentConfig));
      codeContent.textContent = JSON.stringify(currentConfig, null, 2);
    });
    
    // Settings overlay
    const settingsBtn = document.querySelector('#contextMenu button img[alt="Navigation"]').parentElement;
    const settingsOverlay = document.getElementById('settingsOverlay');
    
    // Open settings
    settingsBtn.addEventListener('click', () => {
      document.getElementById('skinName').value = currentConfig.name;
      document.getElementById('skinIdentifier').value = currentConfig.identifier;
      document.getElementById('gameTypeIdentifier').value = currentConfig.gameTypeIdentifier;
      settingsOverlay.style.display = 'flex';
      menu.classList.remove('open');
    });

    // Close settings
    document.getElementById('settingsClose').addEventListener('click', () => {
      settingsOverlay.style.display = 'none';
    });

    // Save settings
    document.getElementById('settingsSave').addEventListener('click', () => {
      currentConfig.name = document.getElementById('skinName').value;
      currentConfig.identifier = document.getElementById('skinIdentifier').value;
      currentConfig.gameTypeIdentifier = document.getElementById('gameTypeIdentifier').value;
      localStorage.setItem('currentConfig', JSON.stringify(currentConfig));
      codeContent.textContent = JSON.stringify(currentConfig, null, 2);
      settingsOverlay.style.display = 'none';
    });
  </script>
</body>
</html>
